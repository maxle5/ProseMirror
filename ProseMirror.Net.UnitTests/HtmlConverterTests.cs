using FluentAssertions;
using ProseMirror.Net.Services;
using Xunit;

namespace ProseMirror.Net.UnitTests
{
    public class HtmlConverterTests
    {
        private const string _expectedJson = "{\"type\":\"doc\",\"content\":[{\"attrs\":{\"level\":1},\"type\":\"heading\",\"content\":[{\"text\":\"A heading\",\"type\":\"text\"}]},{\"attrs\":{\"textAlign\":\"left\"},\"type\":\"paragraph\"},{\"attrs\":{\"textAlign\":\"left\"},\"type\":\"paragraph\",\"content\":[{\"text\":\"T\",\"type\":\"text\"},{\"marks\":[{\"type\":\"bold\"}],\"text\":\"his is \",\"type\":\"text\"},{\"text\":\"some text. \",\"type\":\"text\"},{\"marks\":[{\"type\":\"underline\"}],\"text\":\"with underline text.\",\"type\":\"text\"},{\"text\":\" -\",\"type\":\"text\"},{\"marks\":[{\"attrs\":{\"color\":\"#0d5bd9\"},\"type\":\"textStyle\"}],\"text\":\" \",\"type\":\"text\"},{\"marks\":[{\"type\":\"italic\"},{\"attrs\":{\"color\":\"#0d5bd9\"},\"type\":\"textStyle\"}],\"text\":\"w\",\"type\":\"text\"},{\"marks\":[{\"type\":\"bold\"},{\"type\":\"italic\"},{\"attrs\":{\"color\":\"#0d5bd9\"},\"type\":\"textStyle\"}],\"text\":\"ith color\",\"type\":\"text\"}]},{\"attrs\":{\"textAlign\":\"left\"},\"type\":\"paragraph\"},{\"attrs\":{\"textAlign\":\"left\"},\"type\":\"paragraph\"},{\"attrs\":{\"textAlign\":\"center\"},\"type\":\"paragraph\",\"content\":[{\"marks\":[{\"attrs\":{\"color\":\"#000000\"},\"type\":\"textStyle\"}],\"text\":\"center alignment \",\"type\":\"text\"}]},{\"attrs\":{\"textAlign\":\"center\"},\"type\":\"paragraph\"},{\"attrs\":{\"start\":1},\"type\":\"orderedList\",\"content\":[{\"type\":\"listItem\",\"content\":[{\"attrs\":{\"textAlign\":\"left\"},\"type\":\"paragraph\",\"content\":[{\"text\":\"an ordered list\",\"type\":\"text\"}]}]},{\"type\":\"listItem\",\"content\":[{\"attrs\":{\"textAlign\":\"left\"},\"type\":\"paragraph\",\"content\":[{\"text\":\"item2 \",\"type\":\"text\"}]}]},{\"type\":\"listItem\",\"content\":[{\"attrs\":{\"textAlign\":\"left\"},\"type\":\"paragraph\",\"content\":[{\"text\":\"item3\",\"type\":\"text\"}]}]}]},{\"type\":\"horizontalRule\"},{\"type\":\"bulletList\",\"content\":[{\"type\":\"listItem\",\"content\":[{\"attrs\":{\"textAlign\":\"left\"},\"type\":\"paragraph\",\"content\":[{\"text\":\"item 1\",\"type\":\"text\"}]}]},{\"type\":\"listItem\",\"content\":[{\"attrs\":{\"textAlign\":\"left\"},\"type\":\"paragraph\",\"content\":[{\"text\":\"item 2\",\"type\":\"text\"}]}]},{\"type\":\"listItem\",\"content\":[{\"attrs\":{\"textAlign\":\"left\"},\"type\":\"paragraph\",\"content\":[{\"text\":\"item 3\",\"type\":\"text\"}]}]}]},{\"attrs\":{\"textAlign\":\"left\"},\"type\":\"paragraph\"},{\"attrs\":{\"textAlign\":\"left\"},\"type\":\"paragraph\",\"content\":[{\"text\":\"Todo:\",\"type\":\"text\"}]},{\"type\":\"bulletList\",\"content\":[{\"type\":\"listItem\",\"content\":[{\"attrs\":{\"textAlign\":\"left\"},\"type\":\"paragraph\",\"content\":[{\"text\":\"Convert RTF to Html \",\"type\":\"text\"}]}]},{\"type\":\"listItem\",\"content\":[{\"attrs\":{\"textAlign\":\"left\"},\"type\":\"paragraph\",\"content\":[{\"text\":\"Convert Html to Prosemirror\",\"type\":\"text\"}]}]}]},{\"attrs\":{\"textAlign\":\"left\"},\"type\":\"paragraph\"},{\"type\":\"blockquote\",\"content\":[{\"attrs\":{\"textAlign\":\"left\"},\"type\":\"paragraph\",\"content\":[{\"text\":\"some quoted text\",\"type\":\"text\"}]}]},{\"attrs\":{\"textAlign\":\"left\"},\"type\":\"paragraph\"},{\"attrs\":{\"textAlign\":\"left\"},\"type\":\"paragraph\",\"content\":[{\"marks\":[{\"attrs\":{\"href\":\"https://google.ca\",\"target\":\"_blank\"},\"type\":\"link\"}],\"text\":\"a hyperlink to google\",\"type\":\"text\"}]},{\"attrs\":{\"textAlign\":\"left\"},\"type\":\"paragraph\"},{\"attrs\":{\"src\":\"https://hips.hearstapps.com/hmg-prod.s3.amazonaws.com/images/dog-puppy-on-garden-royalty-free-image-1586966191.jpg?crop=1.00xw:0.669xh;0,0.190xh&amp;resize=1200:*\",\"width\":256},\"type\":\"image\"},{\"attrs\":{\"textAlign\":\"left\"},\"type\":\"paragraph\"},{\"type\":\"table\",\"content\":[{\"type\":\"tableRow\",\"content\":[{\"attrs\":{\"colSpan\":1,\"rowSpan\":1},\"type\":\"tableHeader\",\"content\":[{\"attrs\":{\"textAlign\":\"left\"},\"type\":\"paragraph\",\"content\":[{\"text\":\"First Name\",\"type\":\"text\"}]}]},{\"attrs\":{\"colSpan\":1,\"rowSpan\":1},\"type\":\"tableHeader\",\"content\":[{\"attrs\":{\"textAlign\":\"left\"},\"type\":\"paragraph\",\"content\":[{\"text\":\"Last Name\",\"type\":\"text\"}]}]}]},{\"type\":\"tableRow\",\"content\":[{\"attrs\":{\"colSpan\":1,\"rowSpan\":1},\"type\":\"tableCell\",\"content\":[{\"attrs\":{\"textAlign\":\"left\"},\"type\":\"paragraph\",\"content\":[{\"text\":\"Max\",\"type\":\"text\"}]}]},{\"attrs\":{\"colSpan\":1,\"rowSpan\":1},\"type\":\"tableCell\",\"content\":[{\"attrs\":{\"textAlign\":\"left\"},\"type\":\"paragraph\",\"content\":[{\"text\":\"Lefebvre\",\"type\":\"text\"}]}]}]},{\"type\":\"tableRow\",\"content\":[{\"attrs\":{\"colSpan\":1,\"rowSpan\":1},\"type\":\"tableCell\",\"content\":[{\"attrs\":{\"textAlign\":\"left\"},\"type\":\"paragraph\",\"content\":[{\"text\":\"Luc\",\"type\":\"text\"}]}]},{\"attrs\":{\"colSpan\":1,\"rowSpan\":1},\"type\":\"tableCell\",\"content\":[{\"attrs\":{\"textAlign\":\"left\"},\"type\":\"paragraph\",\"content\":[{\"text\":\"Lefebvre\",\"type\":\"text\"}]}]}]},{\"type\":\"tableRow\",\"content\":[{\"attrs\":{\"colSpan\":1,\"rowSpan\":1},\"type\":\"tableCell\",\"content\":[{\"attrs\":{\"textAlign\":\"left\"},\"type\":\"paragraph\",\"content\":[{\"text\":\"Liam\",\"type\":\"text\"}]}]},{\"attrs\":{\"colSpan\":1,\"rowSpan\":1},\"type\":\"tableCell\",\"content\":[{\"attrs\":{\"textAlign\":\"left\"},\"type\":\"paragraph\",\"content\":[{\"text\":\"Lefebvre\",\"type\":\"text\"}]}]}]}]}]}";

        [Fact]
        public void Convert_ShouldReturnProseMirror_WhenValidArguments()
        {
            // arrange
            var converter = new HtmlConverter();
            const string html = "<html><head><meta charset='utf-8'><meta http-equiv='X-UA-Compatible' content='IE=edge'><title>Test Page</title></head><body><h1>A heading</h1><p></p><p>T<strong>his is </strong>some text. <u>with underline text.</u> -<span style='color: #0d5bd9'> </span><em><span style='color: #0d5bd9'>w</span></em><strong><em><span style='color: #0d5bd9'>ith color</span></em></strong></p><p></p><p></p><p style='text-align: center'><span style='color: #000000'>center alignment </span></p><p style='text-align: center'></p><ol><li><p>an ordered list</p></li><li><p>item2 </p></li><li><p>item3</p></li></ol><hr><ul><li><p>item 1</p></li><li><p>item 2</p></li><li><p>item 3</p></li></ul><p></p><p>Todo:</p><ul data-type='taskList'><li data-checked='false' data-type='taskItem'><label><input type='checkbox'><span></span></label><div><p>Convert RTF to Html </p></div></li><li data-checked='false' data-type='taskItem'><label><input type='checkbox'><span></span></label><div><p>Convert Html to Prosemirror</p></div></li></ul><p></p><blockquote><p>some quoted text</p></blockquote><p></p><p><a target='_blank' rel='noopener noreferrer nofollow' href='https://google.ca'>a hyperlink to google</a></p><p></p><img src='https://hips.hearstapps.com/hmg-prod.s3.amazonaws.com/images/dog-puppy-on-garden-royalty-free-image-1586966191.jpg?crop=1.00xw:0.669xh;0,0.190xh&amp;resize=1200:*' width='256'><p></p><table><tbody><tr><th colspan='1' rowspan='1' colwidth='100'><p>First Name</p></th><th colspan='1' rowspan='1' colwidth='100'><p>Last Name</p></th></tr><tr><td colspan='1' rowspan='1' colwidth='100'><p>Max</p></td><td colspan='1' rowspan='1' colwidth='100'><p>Lefebvre</p></td></tr><tr><td colspan='1' rowspan='1' colwidth='100'><p>Luc</p></td><td colspan='1' rowspan='1' colwidth='100'><p>Lefebvre</p></td></tr><tr><td colspan='1' rowspan='1' colwidth='100'><p>Liam</p></td><td colspan='1' rowspan='1' colwidth='100'><p>Lefebvre</p></td></tr></tbody></table></body></html>";

            // act
            var obj = converter.Convert(html);
            var json = ProseMirrorConvert.SerializeToJson(obj);

            // assert
            obj.Should().NotBeNull();
            json.Should().Be(_expectedJson);
        }
    }
}